1ï¸âƒ£ Apache Web Server Installation Script
#!/bin/bash
sudo su -
yum update -y
yum install httpd -y
systemctl start httpd
systemctl enable httpd
chkconfig httpd on
systemctl start httpd
systemctl enable httpd

Breakdown:

#!/bin/bash â†’ Tells Linux to use Bash shell for this script.

sudo su - â†’ Switch to the root user.

yum update -y â†’ Updates all installed packages to the latest version (-y auto-confirms).

yum install httpd -y â†’ Installs Apache HTTP Web Server.

systemctl start httpd â†’ Starts the Apache service.

systemctl enable httpd â†’ Enables Apache to auto-start on boot.

chkconfig httpd on â†’ Legacy command (older init systems). Ensures Apache runs at boot.

Repeated systemctl start/enable httpd â†’ Not necessary, but ensures service is running & persistent.

âœ… Purpose: Install and run Apache web server on Amazon Linux.

2ï¸âƒ£ Nginx Installation Script
#!/bin/bash
sudo yum update -y
sudo amazon-linux-extras install -y nginx1 
cat /etc/system-release
sudo yum install -y nginx1
sudo systemctl start nginx1

Breakdown:

sudo yum update -y â†’ Updates packages.

sudo amazon-linux-extras install -y nginx1 â†’ Enables and installs Nginx package from Amazon Linux extras repo.

cat /etc/system-release â†’ Shows OS version (useful for compatibility checks).

sudo yum install -y nginx1 â†’ Ensures nginx1 package is installed.

sudo systemctl start nginx1 â†’ Starts Nginx service.

âœ… Purpose: Install and start Nginx web server.

3ï¸âƒ£ CPU Utilization Monitoring
cpu utilization monitoring : sar -1 2


sar = System Activity Reporter.

Command: sar -1 2

-1 â†’ Report CPU usage per 1 second.

2 â†’ Run the check for 2 intervals.

Example output:

%user %system %idle
 5.00   2.00   93.00


âœ… Purpose: Monitor CPU utilization in real-time.

4ï¸âƒ£ Stress Testing CPU
sudo yum install stress
for i in 1 2 3 4; do while : ; do : ; done & done

Breakdown:

sudo yum install stress â†’ Installs stress testing tool.

for i in 1 2 3 4; do while : ; do : ; done & done

Creates 4 infinite loops (background processes).

Each consumes CPU resources, generating artificial load.

âœ… Purpose: Simulate high CPU utilization for testing/monitoring.

5ï¸âƒ£ Filesystem Recovery (Lost Private Key Case)
lsblk
sudo mkdir /mnt/tempvol
sudo mount -o nouuid /dev/xvdf1 /mnt/tempvol
cp .ssh/authorizes_keys /mnt/tempvol/home/ec2-user/.ssh/authorizes_keys
sudo ls -l /mnt/tempvol/home/ec2-user/.ssh
sudo umount /mnt/tempvol

Breakdown:

lsblk â†’ Lists block devices (disks/volumes).

sudo mkdir /mnt/tempvol â†’ Creates mount directory.

sudo mount -o nouuid /dev/xvdf1 /mnt/tempvol

Mounts volume /dev/xvdf1 to /mnt/tempvol.

-o nouuid avoids UUID conflicts.

cp .ssh/authorized_keys /mnt/tempvol/home/ec2-user/.ssh/authorized_keys

Copies your public key into the EC2 userâ€™s .ssh folder.

Lets you regain access if the original private key is lost.

sudo ls -l â†’ Verify permissions.

sudo umount /mnt/tempvol â†’ Safely unmount volume.

âœ… Purpose: Recover EC2 access by injecting a new SSH key.

6ï¸âƒ£ Format and Mount a New Attached Volume
lsblk
sudo file -s /dev/xvdf
sudo lsblk -f
sudo mkfs -t xfs /dev/xvdf
sudo yum install xfsprogs
sudo mkdir /data
sudo mount /dev/xvdf /data

Breakdown:

lsblk â†’ Shows attached disks.

sudo file -s /dev/xvdf â†’ Checks if the volume has a filesystem.

sudo lsblk -f â†’ Lists filesystem types and UUIDs.

sudo mkfs -t xfs /dev/xvdf â†’ Creates XFS filesystem (default in Amazon Linux 2).
(Use mke2fs -j for ext3/ext4 large FS.)

sudo yum install xfsprogs â†’ Install tools for managing XFS filesystems.

sudo mkdir /data â†’ Creates mount directory.

sudo mount /dev/xvdf /data â†’ Mounts new volume to /data.

âœ… Purpose: Prepare and mount a new empty EBS volume.

7ï¸âƒ£ Make Mount Persistent (Auto-Mount After Reboot)
vi /etc/fstab
mount -a
sudo cp /etc/fstab /etc/fstab.orig
sudo blkid
sudo lsblk -o +UUID
sudo vim /etc/fstab

Breakdown:

/etc/fstab â†’ Defines filesystems to mount at boot.

mount -a â†’ Re-mounts all entries in /etc/fstab.

sudo cp /etc/fstab /etc/fstab.orig â†’ Backup before changes.

sudo blkid â†’ Shows UUID of devices.

sudo lsblk -o +UUID â†’ Displays block devices with UUID.

Edit /etc/fstab to add:

UUID=<volume-uuid>   /data   xfs   defaults,nofail   0   2


After reboot, volume will auto-mount.

âœ… Purpose: Ensure attached EBS volume mounts automatically at startup.

ğŸ¯ Summary

Apache/Nginx setup â†’ Install web servers.

CPU monitoring & stress â†’ Use sar + stress.

Filesystem recovery â†’ Regain EC2 access if SSH key lost.

Attach/format/mount volume â†’ Manage storage.

fstab â†’ Auto-mount after reboot.

